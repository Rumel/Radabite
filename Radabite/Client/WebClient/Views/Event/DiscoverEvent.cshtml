@using Radabite.Backend.Database
@using Radabite.Client.WebClient.Models

@{
	ViewBag.Title = "Discover Event";
}

@model UserModel

<div class="row">
	<hgroup class="title">
		<h2>@User.Identity.Name's @ViewBag.Message</h2>
	</hgroup>

</div>

<div class="row">
	<div class="large-4 medium-4 columns">
		<table style="width: 100%">
	        <thead><tr><th style="text-align: center">Friends</th></tr></thead>
		    @Html.Partial("~/Client/WebClient/Views/Shared/_UserTable.cshtml", @Model.Friends)
        </table>
	</div>
	<div class="large-8 medium-8 columns" id="event-container">
        <div id="invitationList">
            @Html.Partial("~/Client/WebClient/Views/Event/_DiscoverInvitationList.cshtml", Model)
        </div>
        <div id="discoverList">
            <table style="width: 100%">
			    <thead><tr><th>Events (@Model.DiscoverEvents.Count())</th></tr></thead>
			    <tbody>
				    @{
                        if (Model.DiscoverEvents.Count == 0)
                        {
						    <tr><td>There are no events near you.</td></tr>
                        }
                        else
                        {
                            foreach (Event e in Model.DiscoverEvents)
                            {
							    <tr><td>@Html.ActionLink(e.Title, "../Event", new { eventId = e.Id })</td></tr>
                            }
                        }
				    }
			    </tbody>
		    </table>
        </div>
	</div>
</div>

<script type="text/javascript">
    function processInvitationResponse(a, action) {
        var container = $(a).parents('div#event-container');
        var resultDiv = $($(a).attr('href'), container);
        console.log(container);
        console.log(resultDiv);

        var eId = $(a).parent().siblings('div#eventId').text();
        var uId = @Model.User.Id
        console.log(eId + ", " + uId);
        $.ajax({
            url: action,
            type: 'POST',
            dataType: "json",
            data: {
                userId: uId,
                eventId: eId,
                response: $(a).text()
            },
            dataType: "html",
            success: function(response) {
                resultDiv.html('');
                resultDiv.html(response);
            }
        });
    }
</script>
